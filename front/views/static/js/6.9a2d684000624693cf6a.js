webpackJsonp([6],{"702o":function(t,e,i){(t.exports=i("I71c")(!0)).push([t.i,"\n.auth-title {\n  margin: 20px 5px;\n}\n.mrg10 {\n  margin: 10px;\n}\n.el-row::after,\n.el-row::before {\n  display: initial;\n}\n","",{version:3,sources:["F:/OTProduction/app/src/views/settings/auth/ot-auth-setting.vue"],names:[],mappings:";AACA;EACE,iBAAiB;CAClB;AACD;EACE,aAAa;CACd;AACD;;EAEE,iBAAiB;CAClB",file:"ot-auth-setting.vue",sourcesContent:["\n.auth-title {\n  margin: 20px 5px;\n}\n.mrg10 {\n  margin: 10px;\n}\n.el-row::after,\n.el-row::before {\n  display: initial;\n}\n"],sourceRoot:""}])},DOox:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("aA9S"),a=i.n(n),s=i("Gw49"),l=i("TDFl"),r={mounted:function(){this.getDeptList()},methods:{getDeptList:function(t){var e=this,i=t||{};s.a.getDeptList(i).then(function(t){1===t.code?(e.deptList=t.data,e.deptList&&e.deptList[0]&&(e.sDeptIndex=e.deptList[0].id,e.pDept=e.deptList[0],e.pDept.sDeptIndex=e.deptList[0].id,e.deptList[0].checkerName&&e.getAuthList({realname:e.deptList[0].checkerName}),e.getChildDeptList({parent:e.sDeptIndex}))):e.$message.error(t.msg)})},getAuthList:function(t){var e=this;Object(l.a)(t).then(function(t){1===t.code?(e.pDept.authList=t.data,e.pDept.authList&&e.pDept.authList[0]&&(e.pDept.sAuthIndex=e.pDept.authList[0].id,e.pDept=a()({},e.pDept))):e.$message.error(t.msg)})},getChildDeptList:function(t){var e=this,i=t||{};s.a.getDeptList(i).then(function(t){1===t.code?(e.childDeptList=t.data,e.childDeptList.forEach(function(t,i){t&&t.checkerName&&Object(l.a)({realname:t.checkerName}).then(function(n){1===n.code&&n.data&&n.data[0]&&(t.authList=n.data,t.sAuthIndex=n.data[0].id,e.$set(e.childDeptList,i,t))})})):e.$message.error(t.msg)})},filterAuth:function(t){var e=this;t&&(console.log("@parent:Search: "+t),setTimeout(function(){Object(l.a)({account:t,realname:t}).then(function(t){1===t.code&&(e.pDept.authList=t.data,e.pDept=a()({},e.pDept))})},200))},filterChirdAuth:function(t){var e=this;t&&setTimeout(function(){Object(l.a)({account:t,realname:t}).then(function(t){1===t.code&&(e.childDeptList[e.sChildDeptIndex].authList=t.data,e.childDeptList=a()({},e.childDeptList))})},200)},change:function(t){var e=this.deptList.find(function(e){return e.id===t});this.pDept=e,e.checkerName&&this.getAuthList({realname:e.checkerName}),this.getChildDeptList({parent:e.id})},selectAuth:function(t){this.pDept.sAuthIndex=t},selectChildDept:function(t){this.sChildDeptIndex=t},seleChildAuth:function(t){var e=this.childDeptList[this.sChildDeptIndex].authList.find(function(e){return e.id===t});this.childDeptList[this.sChildDeptIndex].sAuthIndex=e.id,this.childDeptList=a()({},this.childDeptList)},changeDeptChecker:function(t){var e=this;if(t&&t.authList){var i=t.authList.find(function(e){return e.id===t.sAuthIndex});s.a.updateDept({id:t.id,checker:i.account,checkerName:i.realname}).then(function(t){1===t.code?e.$message(t.msg):e.$message.error(t.msg)})}else this.$message.error("请选择部门或者部门审批人")}},data:function(){return{deptList:[],pDept:{authList:[],sDeptIndex:"",sAuthIndex:null},childDeptList:[],sDeptIndex:"",sAuthIndex:"",sChildDeptIndex:"",formLabelWidth:"120px"}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"auth-title"},[t._v("审批权限")]),t._v(" "),i("div",{staticClass:"auth-title"}),t._v(" "),i("div",[i("el-row",[i("el-col",{attrs:{span:6}},[i("div",[i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.change},model:{value:t.sDeptIndex,callback:function(e){t.sDeptIndex=e},expression:"sDeptIndex"}},t._l(t.deptList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),i("el-col",{attrs:{span:18}},[i("div",[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"部门负责人","label-width":t.formLabelWidth}},[i("el-input",{attrs:{disabled:""},model:{value:t.pDept.checkerName,callback:function(e){t.$set(t.pDept,"checkerName",e)},expression:"pDept.checkerName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"审批人","label-width":t.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择",filterable:"",remote:"","remote-method":t.filterAuth},model:{value:t.pDept.sAuthIndex,callback:function(e){t.$set(t.pDept,"sAuthIndex",e)},expression:"pDept.sAuthIndex"}},t._l(t.pDept.authList,function(t){return i("el-option",{key:t.id,attrs:{label:t.realname,value:t.id}})})),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.changeDeptChecker(t.pDept)}}},[t._v("确 认")])],1)],1)],1)])],1)],1),t._v(" "),i("div",t._l(t.childDeptList,function(e,n){return t.childDeptList?i("el-row",{key:e.id},[i("el-col",{attrs:{span:6}},[i("div",[i("el-input",{model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"dept.name"}})],1)]),t._v(" "),i("el-col",{attrs:{span:18}},[i("div",{on:{click:function(e){t.selectChildDept(n)}}},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"部门负责人","label-width":t.formLabelWidth}},[i("el-input",{attrs:{disabled:""},model:{value:e.leaderName,callback:function(i){t.$set(e,"leaderName",i)},expression:"dept.leaderName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"审批人","label-width":t.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择",filterable:"",remote:"","remote-method":t.filterChirdAuth},on:{change:t.seleChildAuth},model:{value:e.sAuthIndex,callback:function(i){t.$set(e,"sAuthIndex",i)},expression:"dept.sAuthIndex"}},t._l(e.authList,function(t){return i("el-option",{key:t.id,attrs:{label:t.realname,value:t.id}})})),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(i){t.changeDeptChecker(e)}}},[t._v("确 认")])],1)],1)],1)])],1):t._e()}))])},staticRenderFns:[]};var d=i("X4nt")(r,c,!1,function(t){i("sxGJ")},null,null);e.default=d.exports},Gw49:function(t,e,i){"use strict";var n=i("tNif"),a={getDeptList:function(t){return n.a.post("settings/getDeptList",t,n.a.FULL_LOADING)},updateDept:function(t){return n.a.post("settings/updateDept",t,n.a.FULL_LOADING)},testFile:function(t){return n.a.post("settings/testFile",t,n.a.FULL_LOADING)}};e.a=a},sxGJ:function(t,e,i){var n=i("702o");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i("5ten")("5d4a612c",n,!0,{})}});
//# sourceMappingURL=6.9a2d684000624693cf6a.js.map