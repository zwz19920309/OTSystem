webpackJsonp([6],{DOox:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("woOf"),a=i.n(n),s=i("Gw49"),l=i("TDFl"),r={mounted:function(){this.getDeptList()},methods:{getDeptList:function(e){var t=this,i=e||{};s.a.getDeptList(i).then(function(e){1===e.code?(t.deptList=e.data,t.deptList&&t.deptList[0]&&(t.sDeptIndex=t.deptList[0].id,t.pDept=t.deptList[0],t.pDept.sDeptIndex=t.deptList[0].id,t.deptList[0].checkerName&&t.getAuthList({realname:t.deptList[0].checkerName}),t.getChildDeptList({parent:t.sDeptIndex}))):t.$message.error(e.msg)})},getAuthList:function(e){var t=this;Object(l.a)(e).then(function(e){1===e.code?(t.pDept.authList=e.data,t.pDept.authList&&t.pDept.authList[0]&&(t.pDept.sAuthIndex=t.pDept.authList[0].id,t.pDept=a()({},t.pDept))):t.$message.error(e.msg)})},getChildDeptList:function(e){var t=this,i=e||{};s.a.getDeptList(i).then(function(e){1===e.code?(t.childDeptList=e.data,t.childDeptList.forEach(function(e,i){e&&e.checkerName&&Object(l.a)({realname:e.checkerName}).then(function(n){1===n.code&&n.data&&n.data[0]&&(e.authList=n.data,e.sAuthIndex=n.data[0].id,t.$set(t.childDeptList,i,e))})})):t.$message.error(e.msg)})},filterAuth:function(e){var t=this;e&&(console.log("@parent:Search: "+e),setTimeout(function(){Object(l.a)({account:e,realname:e}).then(function(e){1===e.code&&(t.pDept.authList=e.data,t.pDept=a()({},t.pDept))})},200))},filterChirdAuth:function(e){var t=this;e&&setTimeout(function(){Object(l.a)({account:e,realname:e}).then(function(e){1===e.code&&(t.childDeptList[t.sChildDeptIndex].authList=e.data,t.childDeptList=a()({},t.childDeptList))})},200)},change:function(e){var t=this.deptList.find(function(t){return t.id===e});this.pDept=t,t.checkerName&&this.getAuthList({realname:t.checkerName}),this.getChildDeptList({parent:t.id})},selectAuth:function(e){this.pDept.sAuthIndex=e},selectChildDept:function(e){this.sChildDeptIndex=e},seleChildAuth:function(e){var t=this.childDeptList[this.sChildDeptIndex].authList.find(function(t){return t.id===e});this.childDeptList[this.sChildDeptIndex].sAuthIndex=t.id,this.childDeptList=a()({},this.childDeptList)},changeDeptChecker:function(e){var t=this;if(e&&e.authList){var i=e.authList.find(function(t){return t.id===e.sAuthIndex});s.a.updateDept({id:e.id,checker:i.account,checkerName:i.realname}).then(function(e){1===e.code?t.$message(e.msg):t.$message.error(e.msg)})}else this.$message.error("请选择部门或者部门审批人")}},data:function(){return{deptList:[],pDept:{authList:[],sDeptIndex:"",sAuthIndex:null},childDeptList:[],sDeptIndex:"",sAuthIndex:"",sChildDeptIndex:"",formLabelWidth:"120px"}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"auth-title"},[e._v("审批权限")]),e._v(" "),i("div",{staticClass:"auth-title"}),e._v(" "),i("div",[i("el-row",[i("el-col",{attrs:{span:6}},[i("div",[i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.change},model:{value:e.sDeptIndex,callback:function(t){e.sDeptIndex=t},expression:"sDeptIndex"}},e._l(e.deptList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)]),e._v(" "),i("el-col",{attrs:{span:18}},[i("div",[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"部门负责人","label-width":e.formLabelWidth}},[i("el-input",{attrs:{disabled:""},model:{value:e.pDept.checkerName,callback:function(t){e.$set(e.pDept,"checkerName",t)},expression:"pDept.checkerName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"审批人","label-width":e.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择",filterable:"",remote:"","remote-method":e.filterAuth},model:{value:e.pDept.sAuthIndex,callback:function(t){e.$set(e.pDept,"sAuthIndex",t)},expression:"pDept.sAuthIndex"}},e._l(e.pDept.authList,function(e){return i("el-option",{key:e.id,attrs:{label:e.realname,value:e.id}})})),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.changeDeptChecker(e.pDept)}}},[e._v("确 认")])],1)],1)],1)])],1)],1),e._v(" "),i("div",e._l(e.childDeptList,function(t,n){return e.childDeptList?i("el-row",{key:t.id},[i("el-col",{attrs:{span:6}},[i("div",[i("el-input",{model:{value:t.name,callback:function(i){e.$set(t,"name",i)},expression:"dept.name"}})],1)]),e._v(" "),i("el-col",{attrs:{span:18}},[i("div",{on:{click:function(t){e.selectChildDept(n)}}},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"部门负责人","label-width":e.formLabelWidth}},[i("el-input",{attrs:{disabled:""},model:{value:t.leaderName,callback:function(i){e.$set(t,"leaderName",i)},expression:"dept.leaderName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"审批人","label-width":e.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择",filterable:"",remote:"","remote-method":e.filterChirdAuth},on:{change:e.seleChildAuth},model:{value:t.sAuthIndex,callback:function(i){e.$set(t,"sAuthIndex",i)},expression:"dept.sAuthIndex"}},e._l(t.authList,function(e){return i("el-option",{key:e.id,attrs:{label:e.realname,value:e.id}})})),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(i){e.changeDeptChecker(t)}}},[e._v("确 认")])],1)],1)],1)])],1):e._e()}))])},staticRenderFns:[]};var p=i("VU/8")(r,c,!1,function(e){i("YW1I")},null,null);t.default=p.exports},Gw49:function(e,t,i){"use strict";var n=i("tNif"),a={getDeptList:function(e){return n.a.post("settings/getDeptList",e,n.a.FULL_LOADING)},updateDept:function(e){return n.a.post("settings/updateDept",e,n.a.FULL_LOADING)}};t.a=a},YW1I:function(e,t,i){var n=i("Zhi3");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i("rjj0")("51bee693",n,!0,{})},Zhi3:function(e,t,i){(e.exports=i("FZ+f")(!0)).push([e.i,"\n.auth-title {\n  margin: 20px 5px;\n}\n.mrg10 {\n  margin: 10px;\n}\n.el-row::after,\n.el-row::before {\n  display: initial;\n}\n","",{version:3,sources:["/Users/cninsure/workspace-zzb/NodeJS/OT-Application/app/src/views/settings/auth/ot-auth-setting.vue"],names:[],mappings:";AACA;EACE,iBAAiB;CAClB;AACD;EACE,aAAa;CACd;AACD;;EAEE,iBAAiB;CAClB",file:"ot-auth-setting.vue",sourcesContent:["\n.auth-title {\n  margin: 20px 5px;\n}\n.mrg10 {\n  margin: 10px;\n}\n.el-row::after,\n.el-row::before {\n  display: initial;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=6.95efbe58c9abf60ec626.js.map